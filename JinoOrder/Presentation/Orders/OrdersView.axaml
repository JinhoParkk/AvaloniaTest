<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:JinoOrder.Presentation.Shell"
             xmlns:models="using:JinoOrder.Domain.Orders"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="JinoOrder.Presentation.Orders.OrdersView"
             x:DataType="vm:JinoOrderMainViewModel">

  <UserControl.Styles>
    <Style Selector="Border.order-card">
      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="Padding" Value="16"/>
      <Setter Property="Margin" Value="0,0,0,12"/>
      <Setter Property="BoxShadow" Value="0 2 8 0 #10000000"/>
    </Style>

    <Style Selector="Button.btn-primary">
      <Setter Property="Background" Value="#0078D4"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="20,12"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
    <Style Selector="Button.btn-primary:pointerover /template/ ContentPresenter">
      <Setter Property="Background" Value="#1084D8"/>
    </Style>

    <Style Selector="Button.btn-success">
      <Setter Property="Background" Value="#107C10"/>
      <Setter Property="Foreground" Value="White"/>
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="20,12"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
    <Style Selector="Button.btn-success:pointerover /template/ ContentPresenter">
      <Setter Property="Background" Value="#128812"/>
    </Style>

    <Style Selector="Button.btn-outline">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="20,12"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
    <Style Selector="Button.btn-outline:pointerover /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}"/>
    </Style>
  </UserControl.Styles>

  <ScrollViewer Padding="24">
    <StackPanel>
      <!-- 대기중인 주문 -->
      <TextBlock Text="대기중인 주문" FontSize="18" FontWeight="Bold" Margin="0,0,0,16"/>

      <!-- 대기중 주문 없음 -->
      <Border Classes="order-card" IsVisible="{Binding !PendingOrders.Count}">
        <StackPanel HorizontalAlignment="Center" Spacing="8" Margin="40">
          <PathIcon Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H7v-2h5v2zm5-4H7v-2h10v2zm0-4H7V7h10v2z"
                   Width="48" Height="48" Opacity="0.3"/>
          <TextBlock Text="새로운 주문이 없습니다" FontSize="16" Opacity="0.6" HorizontalAlignment="Center"/>
          <TextBlock Text="주문이 들어오면 여기에 표시됩니다" FontSize="13" Opacity="0.4" HorizontalAlignment="Center"/>
        </StackPanel>
      </Border>

      <!-- 주문 카드들 -->
      <ItemsControl ItemsSource="{Binding PendingOrders}">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Classes="order-card">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                <!-- 주문 헤더 -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
                  <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="{Binding OrderNumber}" FontSize="20" FontWeight="Bold"/>
                    <Border Background="#FF8C00" CornerRadius="12" Padding="10,4">
                      <TextBlock Text="{Binding StatusText}" Foreground="White" FontSize="12"/>
                    </Border>
                  </StackPanel>
                  <TextBlock Grid.Column="1" Text="{Binding WaitingTimeText}" FontSize="13" Opacity="0.6"/>
                </Grid>

                <!-- 고객 정보 -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                  <PathIcon Data="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                           Width="16" Height="16" Opacity="0.5"/>
                  <TextBlock Text="{Binding CustomerName}" FontSize="14"/>
                </StackPanel>

                <!-- 주문 아이템 -->
                <ItemsControl Grid.Row="2" ItemsSource="{Binding Items}" Margin="0,0,0,16">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid ColumnDefinitions="*,Auto" Margin="0,4">
                        <StackPanel Grid.Column="0">
                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{Binding MenuName}" FontSize="15" FontWeight="Medium"/>
                            <TextBlock Text="{Binding Quantity, StringFormat=x{0}}" FontSize="14" Opacity="0.7"/>
                          </StackPanel>
                          <TextBlock Text="{Binding OptionsSummary}" FontSize="12" Opacity="0.5"
                                    IsVisible="{Binding OptionsSummary, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                        </StackPanel>
                        <TextBlock Grid.Column="1" Text="{Binding FormattedTotalPrice}" FontSize="14"/>
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- 총 금액 및 버튼 -->
                <Grid Grid.Row="3" ColumnDefinitions="*,Auto">
                  <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="총" FontSize="14" Opacity="0.7"/>
                    <TextBlock Text="{Binding FormattedTotalAmount}" FontSize="18" FontWeight="Bold"/>
                  </StackPanel>
                  <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Classes="btn-outline" Content="거절"
                            Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).CancelOrderCommand}"
                            CommandParameter="{Binding}"/>
                    <Button Classes="btn-primary" Content="접수하기"
                            Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).AcceptOrderCommand}"
                            CommandParameter="{Binding}"/>
                  </StackPanel>
                </Grid>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- 진행중인 주문 -->
      <TextBlock Text="진행중인 주문" FontSize="18" FontWeight="Bold" Margin="0,24,0,16"/>

      <ItemsControl ItemsSource="{Binding ActiveOrders}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Classes="order-card" MinWidth="200" MaxWidth="320" Margin="0,0,12,12">
              <Grid RowDefinitions="Auto,Auto,Auto">
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
                  <TextBlock Grid.Column="0" Text="{Binding OrderNumber}" FontSize="18" FontWeight="Bold"/>
                  <Border Grid.Column="1" CornerRadius="12" Padding="10,4">
                    <Border.Background>
                      <SolidColorBrush Color="{Binding StatusColor}"/>
                    </Border.Background>
                    <TextBlock Text="{Binding StatusText}" Foreground="White" FontSize="11"/>
                  </Border>
                </Grid>

                <TextBlock Grid.Row="1" Text="{Binding CustomerName}" FontSize="13" Opacity="0.7" Margin="0,0,0,8"/>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8">
                  <Button Classes="btn-success" Content="완료" HorizontalAlignment="Stretch"
                          Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).CompleteOrderCommand}"
                          CommandParameter="{Binding}"
                          IsVisible="{Binding Status, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:OrderStatus.Preparing}}"/>
                  <Button Classes="btn-primary" Content="픽업완료" HorizontalAlignment="Stretch"
                          Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).MarkAsPickedUpCommand}"
                          CommandParameter="{Binding}"
                          IsVisible="{Binding Status, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:OrderStatus.Ready}}"/>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>
  </ScrollViewer>
</UserControl>
