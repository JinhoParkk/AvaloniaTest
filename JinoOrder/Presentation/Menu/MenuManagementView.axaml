<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:JinoOrder.Presentation.Shell"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="JinoOrder.Presentation.Menu.MenuManagementView"
             x:DataType="vm:JinoOrderMainViewModel">

  <UserControl.Styles>
    <Style Selector="Border.menu-card">
      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="Padding" Value="16"/>
      <Setter Property="BoxShadow" Value="0 2 4 0 #10000000"/>
    </Style>

    <Style Selector="RadioButton.category-tab">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="16,12"/>
      <Setter Property="CornerRadius" Value="22"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="Margin" Value="0,0,8,0"/>
    </Style>
    <Style Selector="RadioButton.category-tab:checked">
      <Setter Property="Background" Value="{DynamicResource JinoPrimaryBrush}"/>
      <Setter Property="Foreground" Value="{DynamicResource JinoTextOnPrimaryBrush}"/>
    </Style>
    <Style Selector="RadioButton.category-tab:pointerover">
      <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}"/>
    </Style>

    <Style Selector="Button.btn-outline">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderBrush" Value="{DynamicResource TextFillColorSecondaryBrush}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="MinHeight" Value="44"/>
      <Setter Property="Padding" Value="16,12"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Cursor" Value="Hand"/>
    </Style>
    <Style Selector="Button.btn-outline:pointerover /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListLowBrush}"/>
    </Style>
  </UserControl.Styles>

  <Grid RowDefinitions="Auto,*" Margin="24">
    <StackPanel Grid.Row="0" Margin="0,0,0,20">
      <TextBlock Text="메뉴 관리" FontSize="24" FontWeight="Bold" Margin="0,0,0,16"/>

      <!-- 카테고리 탭 -->
      <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
        <StackPanel Orientation="Horizontal">
          <ItemsControl ItemsSource="{Binding Categories}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <RadioButton Classes="category-tab"
                            Content="{Binding Name}"
                            GroupName="Categories"
                            Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).SelectCategoryCommand}"
                            CommandParameter="{Binding}"/>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </ScrollViewer>
    </StackPanel>

    <!-- 메뉴 그리드 -->
    <ScrollViewer Grid.Row="1">
      <ItemsControl ItemsSource="{Binding MenuItems}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Classes="menu-card" MinWidth="160" MaxWidth="280" Margin="0,0,16,16">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                <!-- 메뉴명 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                  <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold"/>
                  <Border Background="{DynamicResource JinoBadgeSoldOutBrush}" CornerRadius="4" Padding="6,2"
                         IsVisible="{Binding IsSoldOut}">
                    <TextBlock Text="품절" FontSize="10" Foreground="{DynamicResource JinoTextOnPrimaryBrush}"/>
                  </Border>
                  <Border Background="{DynamicResource JinoBadgeNewBrush}" CornerRadius="4" Padding="6,2"
                         IsVisible="{Binding IsNew}">
                    <TextBlock Text="NEW" FontSize="10" Foreground="{DynamicResource JinoTextOnPrimaryBrush}"/>
                  </Border>
                  <Border Background="{DynamicResource JinoBadgePopularBrush}" CornerRadius="4" Padding="6,2"
                         IsVisible="{Binding IsPopular}">
                    <TextBlock Text="인기" FontSize="10"/>
                  </Border>
                </StackPanel>

                <!-- 설명 -->
                <TextBlock Grid.Row="1" Text="{Binding Description}"
                          FontSize="13" Foreground="{DynamicResource JinoTextSecondaryBrush}" TextWrapping="Wrap"
                          TextTrimming="CharacterEllipsis" MaxHeight="40" Margin="0,0,0,8"/>

                <!-- 가격 -->
                <TextBlock Grid.Row="2" Text="{Binding FormattedPrice}"
                          FontSize="18" FontWeight="Bold" Margin="0,0,0,12"/>

                <!-- 품절/숨김 토글 -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8">
                  <Button Classes="btn-outline" FontSize="12"
                          Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).ToggleSoldOutCommand}"
                          CommandParameter="{Binding}">
                    <Panel>
                      <TextBlock Text="품절해제" IsVisible="{Binding IsSoldOut}"/>
                      <TextBlock Text="품절처리" IsVisible="{Binding !IsSoldOut}"/>
                    </Panel>
                  </Button>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</UserControl>
