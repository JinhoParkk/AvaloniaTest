<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:vm="using:JinoOrder.Presentation.Shell"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="JinoOrder.Presentation.Menu.MenuPage"
             x:DataType="vm:JinoOrderMainViewModel">

  <Grid RowDefinitions="Auto,Auto,*" Margin="24">
    <TextBlock Grid.Row="0" Text="메뉴 관리" FontSize="24" FontWeight="SemiBold" Margin="0,0,0,20"/>

    <!-- 카테고리 탭 -->
    <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Margin="0,0,0,20">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <ItemsControl ItemsSource="{Binding Categories}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" Spacing="8"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Button Content="{Binding Name}"
                      Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).SelectCategoryCommand}"
                      CommandParameter="{Binding}"
                      Padding="16,8"
                      CornerRadius="20"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </StackPanel>
    </ScrollViewer>

    <!-- 메뉴 그리드 -->
    <ScrollViewer Grid.Row="2">
      <ItemsControl ItemsSource="{Binding MenuItems}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="16"
                    MinWidth="200" MaxWidth="280" Margin="0,0,16,16">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                <!-- 메뉴명 및 뱃지 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                  <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold"/>
                  <Border Background="#FF6B6B" CornerRadius="4" Padding="6,2" IsVisible="{Binding IsSoldOut}">
                    <TextBlock Text="품절" FontSize="10" Foreground="White"/>
                  </Border>
                  <Border Background="#4ECDC4" CornerRadius="4" Padding="6,2" IsVisible="{Binding IsNew}">
                    <TextBlock Text="NEW" FontSize="10" Foreground="White"/>
                  </Border>
                  <Border Background="#FFE66D" CornerRadius="4" Padding="6,2" IsVisible="{Binding IsPopular}">
                    <TextBlock Text="인기" FontSize="10"/>
                  </Border>
                </StackPanel>

                <!-- 설명 -->
                <TextBlock Grid.Row="1" Text="{Binding Description}"
                          FontSize="13" Opacity="0.6" TextWrapping="Wrap"
                          MaxHeight="40" Margin="0,0,0,8"/>

                <!-- 가격 -->
                <TextBlock Grid.Row="2" Text="{Binding FormattedPrice}"
                          FontSize="18" FontWeight="Bold" Margin="0,0,0,12"/>

                <!-- 품절/숨김 토글 -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="8">
                  <Button Command="{Binding $parent[ItemsControl].((vm:JinoOrderMainViewModel)DataContext).ToggleSoldOutCommand}"
                          CommandParameter="{Binding}">
                    <Panel>
                      <TextBlock Text="품절해제" IsVisible="{Binding IsSoldOut}"/>
                      <TextBlock Text="품절처리" IsVisible="{Binding !IsSoldOut}"/>
                    </Panel>
                  </Button>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</UserControl>
